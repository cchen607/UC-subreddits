---
title: "UC Subreddit Analysis"
author: "Christopher Chen and Sean Saito"
date: "10/16/2025"
format:
  gfm:
    code-fold: true
    code-summary: "Show the code"
---

This project aims to analyze the different micro-political climates across campuses in the University of California system. We are using data from Reddit, scraped using `.json` requests in Python.

```{r}
#| label: load-packages
#| include: false

library(readr) # for read csv files
library(tidyverse) # for data manipulation
library(wordcloud2) # for wordclouds, also see: "htmltools" package
library(grid) # for tables
library(gridExtra) # for plot arrangement
library(RColorBrewer) # colors
library(xts) # for irregular time series
library(plotrix) #3D PIES
library(tm) # for text manipulation
library(knitr) # for tables
```

```{r}
#| label: import-data-clean
#| include: false

################################################## Posts 

Berkeley_posts <- read_csv("data/UC_Data/posts/Berkeley_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCDavis_posts <- read_csv("data/UC_Data/posts/UCDavis_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCI_posts <- read_csv("data/UC_Data/posts/UCI_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCLA_posts <- read_csv("data/UC_Data/posts/UCLA_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
ucmerced_posts <- read_csv("data/UC_Data/posts/ucmerced_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCR_posts <- read_csv("data/UC_Data/posts/ucr_posts.csv") %>%  #updated ucr posts file
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCSantaBarbara_posts <- read_csv("data/UC_Data/posts/UCSantaBarbara_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCSC_posts <- read_csv("data/UC_Data/posts/UCSC_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)
UCSD_posts <- read_csv("data/UC_Data/posts/UCSD_posts.csv") %>% 
  select(id, subreddit, selftext, title, upvote_ratio, score, link_flair_text, num_comments, created_utc)

UC_list <- list(Berkeley_posts, UCDavis_posts, UCI_posts, UCLA_posts, ucmerced_posts, 
                UCR_posts,UCSantaBarbara_posts, UCSC_posts, UCSD_posts)
UC_posts <- do.call(rbind, UC_list) %>% 
  rename(post_id = id)

################################################## Comments             

Berkeley_comments <- read_csv("data/UC_Data/comments/Berkeley_comments.csv") 
UCDavis_comments <- read_csv("data/UC_Data/comments/UCDavis_comments.csv") 
UCI_comments <- read_csv("data/UC_Data/comments/UCI_comments.csv") 
UCLA_comments <- read_csv("data/UC_Data/comments/UCLA_comments.csv") 
ucmerced_comments <- read_csv("data/UC_Data/comments/ucmerced_comments.csv")
UCR_comments <- read_csv("data/UC_Data/comments/UCR_comments.csv") 
UCSantaBarbara_comments <- read_csv("data/UC_Data/comments/UCSantaBarbara_comments.csv") 
UCSC_comments <- read_csv("data/UC_Data/comments/UCSC_comments.csv")
UCSD_comments <- read_csv("data/UC_Data/comments/UCSD_comments.csv") 

UC_list <- list(Berkeley_comments, UCDavis_comments, UCI_comments, UCLA_comments, ucmerced_comments,
                UCR_comments,UCSantaBarbara_comments, UCSC_comments, UCSD_comments)
UC_comments <- do.call(rbind, UC_list)

################################################## Post Sentiments and Flairs

post_sentiments_flairs <- read_csv("data/UC_data/UC_post_sentiments_flair.csv")

UC_posts_data <- post_sentiments_flairs %>% 
  select(post_id, post_sentiment, flair_group) %>% 
  left_join(UC_posts, by = "post_id") %>% 
  select(-link_flair_text) %>% 
  distinct() %>% 
  mutate(timestamp = as.POSIXct(created_utc, origin = "1970-01-01", tz = "UTC")) %>% 
  filter(!is.na(timestamp)) %>% 
  mutate(date = as.Date(timestamp)) %>% 
  mutate(month = format(date,"%b %Y")) %>% 
  mutate(rate_sentiment = factor(ifelse(post_sentiment < -0.25, "negative", 
                                        ifelse(post_sentiment > 0.25, "positive", "neutral")))) %>% 
  filter(!is.na(rate_sentiment))

UC_data <- UC_posts_data %>% 
  left_join(UC_comments, by = "post_id")
```

## Exploratory Data Analysis

### Sentiment

Our data consists of post and comment data from the subreddits of all 9 UC campuses. This includes UC Berkeley, UCLA, UC Santa Barbara, UC Davis, UC San Diego, UC Santa Cruz, UC Riverside, UC Irvine, and UC Merced. Each subreddit was scraped for about 500 posts from the "Top" posts in the last year. The data set we compiled will have 4189 observations with 9 variables. We have data on the upvotes/score on a post, time created, and number of comments. Using LLMs, we measured the sentiment of each post from negative to positive to neutral.

```{r}

sentiment_counts <- as.data.frame(table(UC_posts_data$rate_sentiment)) %>% 
  rename(value = Freq) %>% 
  rename(sentiment = Var1) %>% 
  arrange(desc(value))
pie <- ggplot(sentiment_counts, aes(x= "", y= value, fill = sentiment)) +  # SENTIMENT PIE
  geom_bar(stat="identity", width=1, col = "white") +
  coord_polar("y", start=0) +
  labs(title = "Pie Chart of Post Sentiment Ratings") +
  theme_void() +
  scale_fill_brewer(palette="Dark2") 

table <- tableGrob(sentiment_counts)
grid.arrange(pie, table, widths =c(2,1))
```
As to be expected from online platforms and social media, the majority of posts created on the UC subreddits are negative in sentiment.

### Categories of Discussion

Using LLMs we were able to categorize each post by common topics of college discussions. These include politics, housing, academics, and more. Let's take a look at the sentiment for each category.

```{r}
UC_flair_summary <- UC_posts_data %>% 
  group_by(flair_group) %>% 
  summarize("Mean Sentiment" = mean(post_sentiment), 
            "Negative" = sum(rate_sentiment == "negative"),
            "Neutral" = sum(rate_sentiment == "neutral"),
            "Positive" = sum(rate_sentiment == "positive"),
            "Total" = n()) %>% 
  arrange(desc(`Total`)) %>% 
  rename("Flair" = flair_group)
kable(UC_flair_summary)
```

```{r}
ggplot(UC_posts_data) +
  geom_boxplot(aes(x=reorder(flair_group, post_sentiment), post_sentiment, fill = flair_group)) + # sentiment by flair
  labs(title = "Average Sentiment by Flair Group", x = "Flair", y = "Sentiment") +
  geom_hline(yintercept = 0, col = "red", linetype = "dashed") +
  theme_bw()
```

#### Time

The subreddits also gave us UNIX time stamps for when each post and comment was made. Using this, we can find the exact time a post was created down to the millisecond. The response time of comments to a particular post was calculated as well. Let's see when the Top posts were created:

```{r}
#| fig-height: 3
#| fig-width: 8

daily_counts <- UC_posts_data %>%
  count(date)
ggplot(daily_counts) +    # Times series for number of posts in time period
  geom_line(aes(x = date, y = n)) +
  labs(title = "Times Series of Post Counts", x = "Date", y = "Number of Posts") +
  scale_x_date(
    date_breaks = "2 month",  # Set breaks at every month
    date_labels = "%b %Y") +       # Format labels to show abbreviated month names (e.g., Jan, Feb)
  theme_bw()
```

We can observe an expected dip in activity during the summer months. Let's do the same for the comments in the time period that we were able to scrape.

```{r}
#| fig-height: 3
#| fig-width: 8
UC_comments_time <- UC_comments %>% 
  mutate(timestamp = as.POSIXct(created_utc, origin = "1970-01-01", tz = "UTC")) %>% 
  mutate(date = as.Date(timestamp))
daily_counts <- UC_comments_time %>% 
  count(date)
ggplot(daily_counts) +    # Times series for number of comments in time period (that were able to be scraped)
  geom_line(aes(x = date, y = n)) +
  labs(title = "Times Series of Comment Counts", x = "Date", y = "Number of Comments") +
  scale_x_date(
    date_breaks = "2 month",  # Set breaks at every month
    date_labels = "%b %Y") +       # Format labels to show abbreviated month names (e.g., Jan, Feb)
  theme_bw()
```

#### College Rankings

According to the University of California website, the UC system is the best in the U.S. among public universities in 2026. On September 22nd, the U.S. News & World Report released the 2026 Best Colleges rankings, a list that they disseminate to help students compare universities. UC Berkeley and UCLA are the top two public universities in the country. The UCs are also recognized as top performers on social mobility, with UC Riverside taking the Number 1 spot nationally. Using the rankings by campus below, we can split the 9 UC campuses into 3 different groups, high, middle, and low ranking.

![UC rankings](images/uc_rankings.png){height=400 fig-align="center"}
We can see how sentiment over different topics varies among college ranks.